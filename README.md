# SmartTask FAQ Service

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker & Docker Compose
- Anthropic API –∫–ª—é—á

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞ 5 –º–∏–Ω—É—Ç

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
git clone <repository>
cd smarttask-faq

# 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ API –∫–ª—é—á
cp .env.example .env
–î–æ–±–∞–≤—å—Ç–µ –≤ .env: ANTHROPIC_API_KEY=your-key-here

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up --build

# 4. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open http://localhost:8000
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# Health check
curl http://localhost:8000/api/health
````


## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```markdown
smarttask-faq/
‚îú‚îÄ‚îÄ üìÅ app/                          # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Python)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ core/                    # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/                  # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (SQLAlchemy)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ schemas/                 # Pydantic —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ repositories/            # –ü–∞—Ç—Ç–µ—Ä–Ω Repository (–¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ services/                # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ api/                     # API —Å–ª–æ–∏ (FastAPI –º–∞—Ä—à—Ä—É—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ utils/                   # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ scripts/                 # CLI —Å–∫—Ä–∏–ø—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ üìÅ tests/                       # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ unit/                   # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ integration/            # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ repository/             # –¢–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ services/               # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤–∫–ª—é—á–∞—è RAG –æ—Ü–µ–Ω–∫—É)
‚îú‚îÄ‚îÄ üìÅ alembic/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ versions/               # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ üìÅ static/                     # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (Frontend)
‚îî‚îÄ‚îÄ üìÅ data/                       # –î–∞–Ω–Ω—ã–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö RAG
1. **–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** ‚Üí API
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞** Redis ‚Üí –ï—Å–ª–∏ –µ—Å—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç
3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞** –∑–∞–ø—Ä–æ—Å–∞
4. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫** –≤ pgvector ‚Üí –¢–æ–ø-5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞** —á–µ—Ä–µ–∑ Claude API —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** –≤ PostgreSQL + –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis
7. **–í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤
```
tests/
‚îú‚îÄ‚îÄ unit/                 # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ integration/          # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API
‚îú‚îÄ‚îÄ repository/           # –¢–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –ë–î  
‚îî‚îÄ‚îÄ services/            # –¢–µ—Å—Ç—ã –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
    ‚îî‚îÄ‚îÄ test_evaluation.py # –¢–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã –æ—Ü–µ–Ω–∫–∏ RAG
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
docker-compose exec api pytest

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –æ—Ü–µ–Ω–∫–∏ RAG —Å–∏—Å—Ç–µ–º—ã
docker-compose exec api pytest tests/rag_metrics/test_evaluation.py -v

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
docker-compose exec api pytest tests/ -v --cov=app --cov-report=html

# –ë—ã—Å—Ç—Ä—ã–µ unit-—Ç–µ—Å—Ç—ã (–±–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
docker-compose exec api pytest tests/unit/ tests/rag_metrics/ -v -k "not integration"

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
docker-compose exec api pytest tests/integration/ -v
```

### –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (RAG Eval)

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ RAG pipeline –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º:

**–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤:**
- **Relevance** (–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å) - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç–≤–µ—Ç–∞ –≤–æ–ø—Ä–æ—Å—É
- **Accuracy** (–¢–æ—á–Ω–æ—Å—Ç—å) - —Ñ–∞–∫—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞  
- **Completeness** (–ü–æ–ª–Ω–æ—Ç–∞) - –æ—Ö–≤–∞—Ç –≤—Å–µ—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –≤–æ–ø—Ä–æ—Å–∞
- **Coherence** (–°–≤—è–∑–Ω–æ—Å—Ç—å) - –ª–æ–≥–∏—á–Ω–æ—Å—Ç—å –∏ –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞

**–ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∏—Å–∫–∞:**
- **Precision/Recall** - —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –ø–æ–ª–Ω–æ—Ç–∞ –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤
- **Average Similarity** - —Å—Ä–µ–¥–Ω—è—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è EVAL

```python
from app.services.evaluation import RAGEvaluator

# –û—Ü–µ–Ω–∫–∞ –æ–¥–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
evaluator = RAGEvaluator(db)
result = await evaluator.evaluator.evaluate_single_response(
    question="–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É?",
    answer="–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏...", 
    context=["–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏..."],
    ground_truth="–≠—Ç–∞–ª–æ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç..."
)

# –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–∏—Å—Ç–µ–º—ã
test_questions = [
    {"question": "Q1", "ground_truth": "A1"},
    {"question": "Q2", "ground_truth": "A2"}
]
results = await evaluator.run_comprehensive_evaluation(
    test_questions=test_questions,
    rag_pipeline=rag_pipeline
)
```

### –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

**Unit-—Ç–µ—Å—Ç—ã:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π  
- –ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API endpoints
- –†–∞–±–æ—Ç–∞ —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î –∏ Redis
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞

**–¢–µ—Å—Ç—ã –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –æ—Ü–µ–Ω–∫–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–æ–≤ LLM
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend**: FastAPI, Python 3.11+
- **–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL 16 + pgvector, Redis 7
- **AI/ML**: Anthropic Claude API
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker, Docker Compose
- **–ú–∏–≥—Ä–∞—Ü–∏–∏**: Alembic
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: pytest, pytest-asyncio
- **–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞**: –ö–∞—Å—Ç–æ–º–Ω—ã–π RAG Evaluator

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
docker-compose exec api pytest

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
docker-compose exec api pytest tests/ -v --cov=app --cov-report=html

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
docker-compose exec api pytest tests/rag_metrics/test_evaluation.py -v
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –ë–î
docker-compose up postgres redis -d

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
uvicorn app.main:app --reload
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
```bash
alembic upgrade head
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–µ—Ä–≤–∏—Å —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏:
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- Hit rate –∫—ç—à–∞
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤** (—á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –æ—Ü–µ–Ω–∫–∏)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection —á–µ—Ä–µ–∑ SQLAlchemy
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üêõ –ü–æ–∏—Å–∫ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

### –î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
```bash
docker-compose exec api python -m app.scripts.load_documents
```

### –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
```bash
docker-compose restart redis
```

### –ó–∞–ø—É—Å–∫ –æ—Ü–µ–Ω–∫–∏ —Å–∏—Å—Ç–µ–º—ã
```bash
docker-compose exec api python -m app.scripts.run_evaluation
```

### –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
```bash
docker-compose down -v
docker-compose up --build
```
