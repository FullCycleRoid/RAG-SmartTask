# SmartTask FAQ Service

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker & Docker Compose
- Anthropic API –∫–ª—é—á

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞ 5 –º–∏–Ω—É—Ç

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
git clone <repository>
cd smarttask-faq

# 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ API –∫–ª—é—á
cp .env.example .env
–î–æ–±–∞–≤—å—Ç–µ –≤ .env: ANTHROPIC_API_KEY=your-key-here

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up --build

# 4. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open http://localhost:8000
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# Health check
curl http://localhost:8000/api/health
````


## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```markdown
smarttask-faq/
‚îú‚îÄ‚îÄ üìÅ app/                          # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Python)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ core/                    # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/                  # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (SQLAlchemy)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ schemas/                 # Pydantic —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ repositories/            # –ü–∞—Ç—Ç–µ—Ä–Ω Repository (–¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ services/                # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ api/                     # API —Å–ª–æ–∏ (FastAPI –º–∞—Ä—à—Ä—É—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ utils/                   # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ scripts/                 # CLI —Å–∫—Ä–∏–ø—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ üìÅ tests/                       # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ unit/                   # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ integration/            # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ repository/             # –¢–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ evaluations/            # –¢–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã –æ—Ü–µ–Ω–∫–∏ RAG
‚îú‚îÄ‚îÄ üìÅ alembic/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ versions/               # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ üìÅ static/                     # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (Frontend)
‚îî‚îÄ‚îÄ üìÅ data/                       # –î–∞–Ω–Ω—ã–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö RAG
1. **–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** ‚Üí API
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞** Redis ‚Üí –ï—Å–ª–∏ –µ—Å—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç
3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞** –∑–∞–ø—Ä–æ—Å–∞
4. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫** –≤ pgvector ‚Üí –¢–æ–ø-5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞** —á–µ—Ä–µ–∑ Claude API —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** –≤ PostgreSQL + –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis
7. **–í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤
```
tests/
‚îú‚îÄ‚îÄ unit/                 # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ integration/          # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API
‚îú‚îÄ‚îÄ repository/           # –¢–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –ë–î  
‚îî‚îÄ‚îÄ evaluations/          # –¢–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã –æ—Ü–µ–Ω–∫–∏ RAG
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
#### Before tests
```bash
# –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤, —Å—Ç–∞—Ä—Ç–∞–Ω–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏ —É–±–µ–¥–∏—Ç–µ—Ç—å —á—Ç–æ –æ–Ω–∏ –ø–æ–¥–Ω—è–ª–∏—Å—å. –¢–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –¥–æ–∫–µ—Ä
docker compose up -d
````

#### EVAL tests
```bash

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ evaluation —Ç–µ—Å—Ç–æ–≤
make test-evaluation:

```

#### Tests
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
make test

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test

# –ó–∞–ø—É—Å–∫ unit —Ç–µ—Å—Ç–æ–≤
make test-unit

# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
make test-integration

# –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
make coverage

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –≤—ã–≤–æ–¥–æ–º –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
make test-verbose
```

### –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (RAG Eval)

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ RAG pipeline –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º:

**–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤:**
- **Relevance** (–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å) - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç–≤–µ—Ç–∞ –≤–æ–ø—Ä–æ—Å—É
- **Accuracy** (–¢–æ—á–Ω–æ—Å—Ç—å) - —Ñ–∞–∫—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞  
- **Completeness** (–ü–æ–ª–Ω–æ—Ç–∞) - –æ—Ö–≤–∞—Ç –≤—Å–µ—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –≤–æ–ø—Ä–æ—Å–∞
- **Coherence** (–°–≤—è–∑–Ω–æ—Å—Ç—å) - –ª–æ–≥–∏—á–Ω–æ—Å—Ç—å –∏ –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞

**–ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∏—Å–∫–∞:**
- **Precision/Recall** - —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –ø–æ–ª–Ω–æ—Ç–∞ –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤
- **Average Similarity** - —Å—Ä–µ–¥–Ω—è—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤

## üîß –î–∞–ª—å–Ω–µ–π—à–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```bash
1. –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —á–∞–Ω–∫–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞–∑–±–∏–µ–Ω–∏—è –Ω–∞ —á–∞–Ω–∫–∏.
2. –ü–æ–≤—ã—Å–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, —á—Ç–æ–±—ã –ø–æ–¥–Ω—è—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞.
3. –î–æ–±–∞–≤–∏—Ç—å StreamingResponse, —Ç–∞–∫ –∫–∞–∫ —Å–µ–π—á–∞—Å –æ—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Claude.
4. –í–Ω–µ–¥—Ä–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API –∏ —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π.
```

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend**: FastAPI, Python 3.11+
- **–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL 16 + pgvector, Redis 7
- **AI/ML**: Anthropic Claude API
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker, Docker Compose
- **–ú–∏–≥—Ä–∞—Ü–∏–∏**: Alembic
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: pytest, pytest-asyncio
- **–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞**: –ö–∞—Å—Ç–æ–º–Ω—ã–π RAG Evaluator


## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–µ—Ä–≤–∏—Å —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏:
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- Hit rate –∫—ç—à–∞
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤** (—á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –æ—Ü–µ–Ω–∫–∏)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection —á–µ—Ä–µ–∑ SQLAlchemy
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üêõ –ü–æ–∏—Å–∫ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

### –î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
```bash
docker-compose exec api python -m app.scripts.load_documents
```

### –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
```bash
docker-compose restart redis
```

### –ó–∞–ø—É—Å–∫ –æ—Ü–µ–Ω–∫–∏ —Å–∏—Å—Ç–µ–º—ã
```bash
docker-compose exec api python -m app.scripts.run_evaluation
```

### –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
```bash
docker-compose down -v
docker-compose up --build
```
